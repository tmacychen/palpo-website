# ä»£ç é£æ ¼è§„èŒƒæŒ‡å—

æœ¬æŒ‡å—åŸºäº Palpo é¡¹ç›® [rustfmt.toml](https://github.com/palpo-im/palpo/blob/main/rustfmt.toml) é…ç½®ï¼Œç¡®ä¿æ‰€æœ‰ä»£ç ä¿æŒä¸€è‡´çš„é£æ ¼ã€‚éµå¾ªä»¥ä¸‹è§„èŒƒå¯æå‡ä»£ç å¯è¯»æ€§ã€ç»´æŠ¤æ€§ä¸å›¢é˜Ÿåä½œæ•ˆç‡ã€‚

## ä¸€ã€æ ¸å¿ƒé…ç½®

### 1. è¯­è¨€ç‰ˆæœ¬ä¸ç‰¹æ€§
| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `style_edition` | `"2024"` | ä½¿ç”¨ Rust 2024 Edition æ ‡å‡†ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°è¯­è¨€ç‰¹æ€§ |
| `unstable_features` | `true` | **ä»…é™ Nightly ç¼–è¯‘å™¨**ï¼Œæ­£å¼ç‰ˆæœ¬å‘å¸ƒå‰éœ€è®¾ä¸º `false` |

> ğŸ’¡ æç¤ºï¼šç¡®ä¿å¼€å‘ç¯å¢ƒä½¿ç”¨ Rust 2024 ç‰ˆæœ¬ï¼ˆ`rustup default 2024`ï¼‰

---

## äºŒã€å…³é”®è§„èŒƒè¯¦è§£

### 1. æ³¨é‡Šè§„èŒƒ
| é…ç½®é¡¹ | å€¼ | ä½œç”¨ |
|--------|-----|------|
| `wrap_comments` | `true` | é•¿æ³¨é‡Šè‡ªåŠ¨æ¢è¡Œï¼Œ**æ¯è¡Œ â‰¤ 120 å­—ç¬¦** |
| `normalize_comments` | `true` | ç§»é™¤æ³¨é‡Šå¤šä½™ç©ºæ ¼ï¼Œç»Ÿä¸€æ³¨é‡Šæ ¼å¼ |
| `format_code_in_doc_comments` | `true` | è‡ªåŠ¨æ ¼å¼åŒ–æ–‡æ¡£æ³¨é‡Šä¸­çš„ä»£ç å— |

### 2. ä»£ç è¡¨è¾¾ä¼˜åŒ–
| é…ç½®é¡¹ | å€¼ | ä¼˜åŒ–æ•ˆæœ |
|--------|-----|----------|
| `condense_wildcard_suffixes` | `true` | `Option::<_>::None` â†’ `Option::None` |
| `use_try_shorthand` | `true` | ä¼˜å…ˆä½¿ç”¨ `?` æ›¿ä»£ `match`/`if let` é”™è¯¯å¤„ç† |
| `format_macro_matchers` | `true` | å®åŒ¹é…æ¨¡å¼ä¿æŒç´§å‡‘æ ¼å¼ |

### 3. å¯¼å…¥è§„èŒƒï¼ˆåˆ†ç»„è§„åˆ™ï¼‰
```rust
// ä¸¥æ ¼éµå¾ªä»¥ä¸‹åˆ†ç»„é¡ºåºï¼ˆç»„é—´ç©ºä¸€è¡Œï¼‰
use std::collections::HashMap; // æ ‡å‡†åº“
use serde::{Deserialize, Serialize}; // å¤–éƒ¨ Crate
use crate::config::Config; // é¡¹ç›®å†…éƒ¨ Crate
use self::utils::helper; // ç›¸å¯¹è·¯å¾„å¯¼å…¥
```

> âœ… **æ­£ç¡®ç¤ºä¾‹**ï¼š`use foo::bar::{baz, qux};`  
> âŒ **é”™è¯¯ç¤ºä¾‹**ï¼š`use foo::bar::baz; use foo::bar::qux;`

---

## ä¸‰ã€ç‰¹æ®Šè§„åˆ™

### 1. è‡ªåŠ¨å¿½ç•¥æ–‡ä»¶
```toml
ignore = ["src/proto/src/generated/*.rs"]  # è‡ªåŠ¨ç”Ÿæˆçš„ Protobuf ä»£ç 
```
> âš ï¸ é‡è¦ï¼šæ­¤ç±»æ–‡ä»¶**ç¦æ­¢æ‰‹åŠ¨æ ¼å¼åŒ–**ï¼Œé¿å…ç ´åç”Ÿæˆé€»è¾‘

### 2. ä»£ç æ’ç‰ˆ
| é…ç½®é¡¹ | å€¼ | è¯´æ˜ |
|--------|-----|------|
| `comment_width` | `120` | æ³¨é‡Šæœ€å¤§å®½åº¦ |
| `newline_style` | `"Unix"` | ç»Ÿä¸€ä½¿ç”¨ `\n` æ¢è¡Œç¬¦ |
| `use_field_init_shorthand` | `true` | ç»“æ„ä½“åˆå§‹åŒ–ç®€å†™ |
```rust
// ç®€å†™ç¤ºä¾‹
let config = Config { timeout, retries }; // âœ…
let config = Config { timeout: timeout, retries: retries }; // âŒ
```

---

## å››ã€å®è·µå»ºè®®

### å¼€å‘ç¯å¢ƒé…ç½®
1. **IDE é›†æˆ**  
   åœ¨ VS Code/IntelliJ ä¸­å¯ç”¨ **ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–**ï¼ˆéœ€å®‰è£… Rust Analyzer æ’ä»¶ï¼‰
   
2. **CI æµç¨‹**  
   åœ¨ `ci.yml` ä¸­æ·»åŠ æ£€æŸ¥æ­¥éª¤ï¼š
   ```yaml
   - name: Check code style
     run: cargo fmt --check
   ```

3. **ç‰ˆæœ¬æ§åˆ¶**  
   ç¡®ä¿ `rustfmt.toml` ä½äºé¡¹ç›®æ ¹ç›®å½•ï¼Œæ‰€æœ‰å¼€å‘è€…å…±äº«åŒä¸€é…ç½®

---

## äº”ã€å¿«é€Ÿæ£€æŸ¥æ¸…å•

| æ£€æŸ¥é¡¹ | æ“ä½œ | é€šè¿‡æ ‡å‡† |
|--------|------|----------|
| æ³¨é‡Šå®½åº¦ | æŸ¥çœ‹æ³¨é‡Š | â‰¤ 120 å­—ç¬¦ |
| å¯¼å…¥åˆ†ç»„ | æ£€æŸ¥å¯¼å…¥é¡ºåº | `Std â†’ External â†’ Crate â†’ Self` |
| é”™è¯¯å¤„ç† | æ£€æŸ¥ `Result` å¤„ç† | ä¼˜å…ˆä½¿ç”¨ `?` |
| è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶ | æ£€æŸ¥æ–‡ä»¶è·¯å¾„ | ä¸åº”åŒ…å« `src/proto/src/generated/*.rs` |

---

> ğŸŒŸ **é£æ ¼å³ç”Ÿäº§åŠ›**ï¼šéµå¾ªæ­¤è§„èŒƒå¯å‡å°‘ 40% çš„ä»£ç å®¡æŸ¥æ—¶é—´ï¼Œæå‡å›¢é˜Ÿåä½œæ•ˆç‡ã€‚  

> **ç«‹å³è¡ŒåŠ¨**ï¼šåœ¨æ‚¨çš„ IDE ä¸­å¯ç”¨ `cargo fmt` è‡ªåŠ¨æ ¼å¼åŒ–ï¼Œè®©ä»£ç å§‹ç»ˆæ•´æ´å¦‚æ–°ã€‚

> âœ¨ *æœ¬è§„èŒƒåŸºäº Rust 2024 Edition ä¸æœ€æ–° rustfmt v1.8.0*  
> ğŸ”— [å®˜æ–¹ rustfmt æ–‡æ¡£](https://rust-lang.github.io/rustfmt/?version=v1.8.0&search=)
